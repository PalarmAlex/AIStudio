<Window x:Class="AIStudio.Dialogs.ConditionedReflexLoadDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Создание условных рефлексов по шаблону"
        Height="560" Width="780"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        PreviewKeyDown="Window_PreviewKeyDown"
        Loaded="Window_Loaded">

  <Window.Resources>
    <Style x:Key="DialogHeaderStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="16"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="0,0,0,10"/>
    </Style>
    <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="13"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="0,6,0,4"/>
    </Style>
    <Style x:Key="InfoTextStyle" TargetType="TextBlock">
      <Setter Property="Foreground" Value="#FF666666"/>
      <Setter Property="FontStyle" Value="Italic"/>
      <Setter Property="Margin" Value="0,0,0,6"/>
    </Style>
    <Style x:Key="TabHeaderStyle" TargetType="TabItem">
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Padding" Value="10,3"/>
    </Style>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
  </Window.Resources>

  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <Grid x:Name="BusyOverlay"
          Grid.RowSpan="3"
          Background="#80FFFFFF"
          Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
          Panel.ZIndex="1000">
      <StackPanel VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="15,0,0,15">
        <ProgressBar IsIndeterminate="True" Width="200" Height="20" Margin="0,0,0,10"/>
        <TextBlock Text="Создание условных рефлексов..." HorizontalAlignment="Center" FontSize="14"/>
      </StackPanel>
    </Grid>

    <TextBlock Grid.Row="0"
               Text="Создание условных рефлексов по шаблону"
               Style="{StaticResource DialogHeaderStyle}"/>

    <TabControl Grid.Row="1" Margin="0,6,0,6" x:Name="MainTabControl">
      <TabItem Header="Текст рефлексов" Style="{StaticResource TabHeaderStyle}">
        <Grid Margin="0,10,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Border Grid.Row="0"
                  BorderBrush="#FFE0E0E0"
                  BorderThickness="1"
                  CornerRadius="4"
                  Padding="8"
                  Background="#FFF9F9F9"
                  Margin="0,0,0,8">
            <StackPanel>
              <TextBlock Text="Формат текста" FontWeight="SemiBold" Margin="0,0,0,5"/>
              <TextBlock TextWrapping="Wrap" Style="{StaticResource InfoTextStyle}">
                <Run Text="Строка: Состояние|Стили|Триггер безусловного рефлекса|Новый триггер условного рефлекса|Тон|Настроение"/><LineBreak/>
                <Run Text="Стили: имена через + (например: Расслабление+Игра)"/><LineBreak/>
                <Run Text="Триггер безусловного рефлекса: одиночное действие с пульта (внешнее воздействие)"/><LineBreak/>
                <Run Text="Новый триггер: фраза с пульта. Тон и Настроение — по текстовому обозначению (опционально). Крепость 0,95. Стадия 1."/><LineBreak/>
                <Run Text="Пример: Норма|Расслабление+Игра|Поощрить|молодец|Нормальный|Хорошее" FontFamily="Consolas"/>
              </TextBlock>
            </StackPanel>
          </Border>
          <TextBox Grid.Row="1"
                   x:Name="ContentTextBox"
                   Text="{Binding CsvContent, UpdateSourceTrigger=PropertyChanged}"
                   AcceptsReturn="True"
                   AcceptsTab="True"
                   FontFamily="Consolas"
                   FontSize="12"
                   VerticalScrollBarVisibility="Auto"
                   HorizontalScrollBarVisibility="Auto"
                   Padding="4"
                   BorderBrush="#FFE0E0E0"
                   BorderThickness="1"/>
          <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Сохранить в файл" Command="{Binding SaveCsvCommand}" Height="35" Width="130" Margin="0,0,10,0" Cursor="Hand"/>
            <Button Content="Проверить формат" Command="{Binding ValidateCsvCommand}" Height="35" Width="130" Cursor="Hand"/>
          </StackPanel>
        </Grid>
      </TabItem>
      <TabItem Header="Промпт для ИИ" Style="{StaticResource TabHeaderStyle}">
        <Grid Margin="0,10,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Border Grid.Row="0"
                  BorderBrush="#FFE0E0E0"
                  BorderThickness="1"
                  CornerRadius="4"
                  Padding="8"
                  Background="#FFF9F9F9"
                  Margin="0,0,0,8">
            <StackPanel>
              <TextBlock Text="Редактирование промпта для генерации шаблона условных рефлексов" FontWeight="SemiBold" Margin="0,0,0,5"/>
              <TextBlock Text="{Binding PromptFilePath, Mode=OneWay}" TextWrapping="Wrap" Style="{StaticResource InfoTextStyle}"/>
            </StackPanel>
          </Border>
          <TextBox Grid.Row="1"
                   x:Name="PromptEditorTextBox"
                   Text="{Binding PromptContent, UpdateSourceTrigger=PropertyChanged}"
                   AcceptsReturn="True"
                   AcceptsTab="True"
                   FontFamily="Segoe UI"
                   FontSize="12"
                   VerticalScrollBarVisibility="Auto"
                   HorizontalScrollBarVisibility="Auto"
                   Padding="4"
                   BorderBrush="#FFE0E0E0"
                   BorderThickness="1"
                   IsEnabled="{Binding IsPromptEditingEnabled}"/>
          <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Сохранить промпт" Command="{Binding SavePromptCommand}" Height="35" Width="150" Cursor="Hand"/>
          </StackPanel>
        </Grid>
      </TabItem>
      <TabItem Header="Текст для вставки в промпт" x:Name="TabPromptInsert" Style="{StaticResource TabHeaderStyle}">
        <Grid Margin="0,10,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Border Grid.Row="0"
                  BorderBrush="#FFE0E0E0"
                  BorderThickness="1"
                  CornerRadius="4"
                  Padding="8"
                  Background="#FFF9F9F9"
                  Margin="0,0,0,8">
            <StackPanel>
              <TextBlock Text="Текст вставки для промпта генерации условных рефлексов" FontWeight="SemiBold" Margin="0,0,0,5"/>
              <TextBlock TextWrapping="Wrap" Style="{StaticResource InfoTextStyle}">
                <Run Text="Поддерживаются плейсхолдеры: [stileCombination], [InfluenceActionList], [ReflexGenStyleCount], [ReflexGenTriggerCount], [ReflexGenLinesStage1PerState], [ReflexGenLinesStage1ThreeStates]"/>
              </TextBlock>
            </StackPanel>
          </Border>
          <TextBox Grid.Row="1"
                   x:Name="PromptInsertTextBox"
                   Text="{Binding PromptInsertText, UpdateSourceTrigger=PropertyChanged}"
                   AcceptsReturn="True"
                   AcceptsTab="True"
                   FontFamily="Segoe UI"
                   FontSize="12"
                   VerticalScrollBarVisibility="Auto"
                   HorizontalScrollBarVisibility="Auto"
                   Padding="4"
                   BorderBrush="#FFE0E0E0"
                   BorderThickness="1"/>
          <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Создать промпт" Command="{Binding CreatePromptCommand}" Height="35" Width="140" Margin="0,0,10,0" Cursor="Hand"/>
            <Button Content="Сохранить текст" Command="{Binding SaveInsertTextCommand}" Height="35" Width="130" Cursor="Hand"/>
          </StackPanel>
        </Grid>
      </TabItem>
    </TabControl>

    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
      <Button Content="Создать"
              Command="{Binding ApplyCommand}"
              IsEnabled="{Binding CanApply}"
              Height="35"
              Width="120"
              Margin="0,0,10,0"
              Cursor="Hand"
              ToolTip="Создать условные рефлексы по шаблону (только стадия 1)"/>
      <Button Content="Отмена" Command="{Binding CancelCommand}" Height="35" Width="100" Cursor="Hand"/>
    </StackPanel>
  </Grid>
</Window>
