<Window x:Class="AIStudio.Dialogs.ReflexLoadDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Создание безусловных рефлексов шаблону"
        Height="560" Width="780"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        PreviewKeyDown="Window_PreviewKeyDown"
        Loaded="Window_Loaded">

  <Window.Resources>
    <Style x:Key="DialogHeaderStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="16"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="0,0,0,10"/>
    </Style>
    <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="13"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="0,6,0,4"/>
    </Style>
    <Style x:Key="InfoTextStyle" TargetType="TextBlock">
      <Setter Property="Foreground" Value="#FF666666"/>
      <Setter Property="FontStyle" Value="Italic"/>
      <Setter Property="Margin" Value="0,0,0,6"/>
    </Style>
    <Style x:Key="TabHeaderStyle" TargetType="TabItem">
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Padding" Value="10,3"/>
    </Style>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
  </Window.Resources>

  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <Grid x:Name="BusyOverlay"
          Grid.RowSpan="3"
          Background="#80FFFFFF"
          Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
          Panel.ZIndex="1000">
      <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
        <ProgressBar IsIndeterminate="True" Width="200" Height="20" Margin="0,0,0,10"/>
        <TextBlock Text="Создание рефлексов и цепочек..." HorizontalAlignment="Center" FontSize="14"/>
      </StackPanel>
    </Grid>

    <TextBlock Grid.Row="0"
               Text="Создание безусловных рефлексов по шаблону"
               Style="{StaticResource DialogHeaderStyle}"/>

    <TabControl Grid.Row="1" Margin="0,6,0,6" x:Name="MainTabControl">
      <TabItem Header="Текст рефлексов" Style="{StaticResource TabHeaderStyle}">
        <Grid Margin="0,10,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Border Grid.Row="0"
                  BorderBrush="#FFE0E0E0"
                  BorderThickness="1"
                  CornerRadius="4"
                  Padding="8"
                  Background="#FFF9F9F9"
                  Margin="0,0,0,8">
            <StackPanel>
              <TextBlock Text="Формат текста" FontWeight="SemiBold" Margin="0,0,0,5"/>
              <TextBlock TextWrapping="Wrap" Style="{StaticResource InfoTextStyle}">
                <Run Text="Строка: Состояние|Стили|Триггер|Действие|Цепочка"/><LineBreak/>
                <Run Text="Стили: имена через + (например: Расслабление+Игра)"/><LineBreak/>
                <Run Text="Триггер: имя внешнего воздействия или Нет — без триггера (только гомеостаз + стили)"/><LineBreak/>
                <Run Text="Цепочка: 1.Действие(успех,неудача);2.Действие(0,0) — 0 = конец"/><LineBreak/>
                <Run Text="С триггером: Плохо|Страх+Напряжение|Напугать|Пугается|1.Просит помощи(2,0);2.Плачет(0,0)" FontFamily="Consolas"/><LineBreak/>
                <Run Text="Без триггера: Плохо|Страх+Напряжение|Нет|Пугается|1.Просит помощи(2,0);2.Плачет(0,0)" FontFamily="Consolas"/>
              </TextBlock>
            </StackPanel>
          </Border>
          <TextBox Grid.Row="1"
                   x:Name="ContentTextBox"
                   Text="{Binding CsvContent, UpdateSourceTrigger=PropertyChanged}"
                   AcceptsReturn="True"
                   AcceptsTab="True"
                   FontFamily="Consolas"
                   FontSize="12"
                   VerticalScrollBarVisibility="Auto"
                   HorizontalScrollBarVisibility="Auto"
                   Padding="4"
                   BorderBrush="#FFE0E0E0"
                   BorderThickness="1"/>
          <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Сохранить в файл" Command="{Binding SaveCsvCommand}" Height="35" Width="130" Margin="0,0,10,0" Cursor="Hand"/>
            <Button Content="Проверить формат" Command="{Binding ValidateCsvCommand}" Height="35" Width="130" Cursor="Hand"/>
          </StackPanel>
        </Grid>
      </TabItem>
      <TabItem Header="Промпт для ИИ" Style="{StaticResource TabHeaderStyle}">
        <Grid Margin="0,10,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Border Grid.Row="0"
                  BorderBrush="#FFE0E0E0"
                  BorderThickness="1"
                  CornerRadius="4"
                  Padding="8"
                  Background="#FFF9F9F9"
                  Margin="0,0,0,8">
            <StackPanel>
              <TextBlock Text="Редактирование промпта для генерации шаблона рефлексов" FontWeight="SemiBold" Margin="0,0,0,5"/>
              <TextBlock Text="{Binding PromptFilePath, Mode=OneWay}" TextWrapping="Wrap" Style="{StaticResource InfoTextStyle}"/>
            </StackPanel>
          </Border>
          <TextBox Grid.Row="1"
                   x:Name="PromptEditorTextBox"
                   Text="{Binding PromptContent, UpdateSourceTrigger=PropertyChanged}"
                   AcceptsReturn="True"
                   AcceptsTab="True"
                   FontFamily="Segoe UI"
                   FontSize="12"
                   VerticalScrollBarVisibility="Auto"
                   HorizontalScrollBarVisibility="Auto"
                   Padding="4"
                   BorderBrush="#FFE0E0E0"
                   BorderThickness="1"
                   IsEnabled="{Binding IsPromptEditingEnabled}"/>
          <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Сохранить промпт" Command="{Binding SavePromptCommand}" Height="35" Width="150" Cursor="Hand"/>
          </StackPanel>
        </Grid>
      </TabItem>
    </TabControl>

    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
      <Button Content="Создать"
              Command="{Binding ApplyCommand}"
              IsEnabled="{Binding CanApply}"
              Height="35"
              Width="120"
              Margin="0,0,10,0"
              Cursor="Hand"
              ToolTip="Создать рефлексы и цепочки по шаблону"/>
      <Button Content="Отмена" Command="{Binding CancelCommand}" Height="35" Width="100" Cursor="Hand"/>
    </StackPanel>
  </Grid>
</Window>
