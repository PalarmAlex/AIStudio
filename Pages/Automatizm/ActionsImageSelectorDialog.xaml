<Window x:Class="AIStudio.Dialogs.ActionsImageSelectorDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:AIStudio.Converters"
        mc:Ignorable="d"
        Title="Выбор образа действий"
        Height="600"
        Width="900"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        MinHeight="400"
        MinWidth="700">

  <Window.Resources>
    <converters:ListToStringConverter x:Key="ListToStringConverter"/>
    <converters:AutomatizmActionsToTooltipConverter x:Key="AutomatizmActionsToTooltipConverter"/>
    <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>

    <Style x:Key="RowDataGridStyle" TargetType="DataGridRow">
      <Setter Property="Cursor" Value="Hand"/>
      <Style.Triggers>
        <Trigger Property="IsSelected" Value="True">
          <Setter Property="Background" Value="#FFE3F2FD"/>
          <Setter Property="BorderBrush" Value="#FF2196F3"/>
          <Setter Property="BorderThickness" Value="1"/>
        </Trigger>
        <MultiTrigger>
          <MultiTrigger.Conditions>
            <Condition Property="IsSelected" Value="True"/>
            <Condition Property="IsMouseOver" Value="True"/>
          </MultiTrigger.Conditions>
          <Setter Property="Background" Value="#FFBBDEFB"/>
        </MultiTrigger>
      </Style.Triggers>
    </Style>

    <Style x:Key="CheckBoxCellStyle" TargetType="DataGridCell">
      <Setter Property="HorizontalAlignment" Value="Center"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
      <Setter Property="Padding" Value="5"/>
    </Style>
  </Window.Resources>

  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Панель фильтров -->
    <Border Grid.Row="0" 
                BorderBrush="#FFE0E0E0" 
                BorderThickness="1"
                CornerRadius="4"
                Margin="0,0,0,10"
                Padding="8"
                Background="#FFF5F5F5">
      <StackPanel Orientation="Horizontal">
        <TextBlock Text="Фильтры:" 
                           VerticalAlignment="Center" 
                           Margin="0,0,10,0"
                           FontWeight="Bold"/>

        <!-- Фильтр по типу -->
        <StackPanel Orientation="Vertical" Margin="0,0,15,0" Width="200">
          <TextBlock Text="Тип образа" FontSize="12" Margin="0,0,0,2"/>
          <ComboBox ItemsSource="{Binding TypeFilterOptions}"
                              SelectedValue="{Binding SelectedTypeFilter}"
                              DisplayMemberPath="Value"
                              SelectedValuePath="Key"
                              Height="25"/>
        </StackPanel>

        <!-- Фильтр по действиям -->
        <StackPanel Orientation="Vertical" Margin="0,0,15,0" Width="150">
          <TextBlock Text="Содержит действия" FontSize="12" Margin="0,0,0,2"/>
          <CheckBox IsChecked="{Binding HasActionsFilter}"
                              VerticalAlignment="Center"
                              Content="Да"/>
        </StackPanel>

        <!-- Фильтр по фразам -->
        <StackPanel Orientation="Vertical" Margin="0,0,15,0" Width="150">
          <TextBlock Text="Содержит фразы" FontSize="12" Margin="0,0,0,2"/>
          <CheckBox IsChecked="{Binding HasPhrasesFilter}"
                              VerticalAlignment="Center"
                              Content="Да"/>
        </StackPanel>

        <!-- Кнопка сброса -->
        <Button Content="Сбросить фильтры" 
                        Command="{Binding ClearFiltersCommand}"
                        Margin="10,15,0,0"
                        Height="25"
                        Width="120"/>
      </StackPanel>
    </Border>

    <!-- Список образов действий -->
    <Border Grid.Row="1" 
                BorderBrush="#FFE0E0E0" 
                BorderThickness="1"
                CornerRadius="4">
      <DataGrid x:Name="ActionsImagesGrid"
                      ItemsSource="{Binding ActionsImagesView}"
                      IsReadOnly="True"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserReorderColumns="False"
                      CanUserResizeRows="False"
                      CanUserSortColumns="True"
                      SelectionMode="Single"
                      SelectionUnit="FullRow"
                      RowStyle="{StaticResource RowDataGridStyle}"
                      BorderThickness="0"
                      Background="White"
                      RowBackground="#FFF9F9F9"
                      AlternatingRowBackground="White"
                      GridLinesVisibility="None"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Auto"
                      MouseDoubleClick="ActionsImagesGrid_MouseDoubleClick">

        <DataGrid.Columns>
          <!-- Выбор -->
          <DataGridTemplateColumn Width="40">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <RadioButton GroupName="ActionsImageSelection"
                                             IsChecked="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, 
                                                               Path=IsSelected, 
                                                               Mode=OneWay}"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
            <DataGridTemplateColumn.CellStyle>
              <Style TargetType="DataGridCell" BasedOn="{StaticResource CheckBoxCellStyle}">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderBrush" Value="Transparent"/>
              </Style>
            </DataGridTemplateColumn.CellStyle>
          </DataGridTemplateColumn>

          <!-- ID -->
          <DataGridTextColumn Header="ID" 
                                        Binding="{Binding Id}" 
                                        Width="60"
                                        IsReadOnly="True">
            <DataGridTextColumn.CellStyle>
              <Style TargetType="DataGridCell">
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="HorizontalContentAlignment" Value="Center"/>
              </Style>
            </DataGridTextColumn.CellStyle>
          </DataGridTextColumn>

          <!-- Тип -->
          <DataGridTemplateColumn Header="Тип" Width="120">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock>
                                    <Run Text="{Binding Kind}"/>
                                    <Run Text=" - "/>
                                    <Run Text="{Binding KindText}"/>
                </TextBlock>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <!-- Действия -->
          <DataGridTemplateColumn Header="Действия" Width="150">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding ActIdList, Converter={StaticResource ListToStringConverter}}"
                                           TextWrapping="Wrap"
                                           ToolTip="{Binding ActIdList, Converter={StaticResource ListToStringConverter}}"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <!-- Фразы -->
          <DataGridTemplateColumn Header="Фразы" Width="150">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding PhraseIdList, Converter={StaticResource ListToStringConverter}}"
                                           TextWrapping="Wrap"
                                           ToolTip="{Binding PhraseIdList, Converter={StaticResource ListToStringConverter}}"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <!-- Тон -->
          <DataGridTemplateColumn Header="Тон" Width="80">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding ToneText}"
                                           HorizontalAlignment="Center"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <!-- Настроение -->
          <DataGridTemplateColumn Header="Настроение" Width="100">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding MoodText}"
                                           HorizontalAlignment="Center"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <!-- Подробности (кнопка) -->
          <DataGridTemplateColumn Header="Подробнее" Width="100">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <Button Content="Показать"
                                        Command="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}, 
                                                        Path=DataContext.ShowDetailsCommand}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource AgentButtonStyle}"
                                        Padding="5,2"
                                        Margin="2"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>
        </DataGrid.Columns>
      </DataGrid>
    </Border>

    <!-- Выбранный образ -->
    <Border Grid.Row="2"
                BorderBrush="#FFE0E0E0"
                BorderThickness="1"
                CornerRadius="4"
                Margin="0,10,0,10"
                Padding="10"
                Background="#FFF0F8FF"
                Visibility="{Binding SelectedActionsImage, Converter={StaticResource NullToVisibilityConverter}}">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Margin="0,0,15,0">
          <TextBlock Text="Выбранный образ:" 
                               FontWeight="Bold"
                               Margin="0,0,0,5"/>
          <TextBlock Text="ID:"
                               Foreground="#FF666666"/>
          <TextBlock Text="Тип:"
                               Foreground="#FF666666"/>
          <TextBlock Text="Действия:"
                               Foreground="#FF666666"/>
          <TextBlock Text="Фразы:"
                               Foreground="#FF666666"/>
          <TextBlock Text="Тон:"
                               Foreground="#FF666666"/>
          <TextBlock Text="Настроение:"
                               Foreground="#FF666666"/>
        </StackPanel>

        <StackPanel Grid.Column="1">
          <TextBlock Text="{Binding SelectedActionsImage.Id}"
                               FontWeight="Bold"
                               Margin="0,0,0,5"/>
          <TextBlock Text="{Binding SelectedActionsImage.KindText}"
                               Margin="0,0,0,3"/>
          <TextBlock Text="{Binding SelectedActionsImage.ActIdListString}"
                               Margin="0,0,0,3"/>
          <TextBlock Text="{Binding SelectedActionsImage.PhraseIdListString}"
                               Margin="0,0,0,3"/>
          <TextBlock Text="{Binding SelectedActionsImage.ToneText}"
                               Margin="0,0,0,3"/>
          <TextBlock Text="{Binding SelectedActionsImage.MoodText}"
                               Margin="0,0,0,3"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Кнопки -->
    <Grid Grid.Row="3">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <!-- Информация -->
      <TextBlock Grid.Column="0"
                       Text="{Binding SelectionInfo}"
                       VerticalAlignment="Center"
                       FontStyle="Italic"
                       Foreground="#FF666666"/>

      <!-- Кнопка отмены -->
      <Button Grid.Column="1"
                    Content="Отмена"
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource AgentButtonStyle}"
                    Width="100"
                    Margin="0,0,10,0"/>

      <!-- Кнопка выбора -->
      <Button Grid.Column="2"
                    Content="Выбрать"
                    Command="{Binding SelectCommand}"
                    Style="{StaticResource ActionButtonStyle}"
                    Width="100"
                    IsEnabled="{Binding CanSelect}"/>
    </Grid>
  </Grid>
</Window>