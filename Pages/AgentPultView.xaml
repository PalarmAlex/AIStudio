<UserControl x:Class="AIStudio.Pages.AgentPultView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:AIStudio.Pages"
             mc:Ignorable="d" 
             d:DesignHeight="500" d:DesignWidth="900">

  <UserControl.Resources>
    <Style x:Key="PropertyNameStyle" TargetType="TextBlock">
      <Setter Property="HorizontalAlignment" Value="Left"/>
      <Setter Property="Margin" Value="0,0,0,5"/>
      <Setter Property="Width" Value="200"/>
      <Setter Property="FontSize" Value="14"/>
      <Setter Property="FontWeight" Value="Bold"/>
    </Style>

    <Style x:Key="PropertyValueStyle" TargetType="FrameworkElement">
      <Setter Property="HorizontalAlignment" Value="Left"/>
      <Setter Property="MinWidth" Value="400"/>
    </Style>

    <Style x:Key="EditableFieldStyle" TargetType="TextBox" BasedOn="{StaticResource PropertyValueStyle}">
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="#FF7F9DB9"/>
      <Setter Property="Padding" Value="2"/>
    </Style>

    <Style x:Key="RecognitionTextStyle" TargetType="TextBlock">
      <Setter Property="FontFamily" Value="Courier New"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Foreground" Value="DarkRed"/>
      <Setter Property="Background" Value="#FFF8F8F8"/>
      <Setter Property="Padding" Value="5"/>
      <Setter Property="TextWrapping" Value="Wrap"/>
    </Style>

    <Style x:Key="ChainPanelStyle" TargetType="StackPanel">
      <Setter Property="Margin" Value="0,5,0,0"/>
      <Setter Property="HorizontalAlignment" Value="Left"/>
      <Setter Property="VerticalAlignment" Value="Top"/>
    </Style>

  </UserControl.Resources>

  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="350"/>
      <ColumnDefinition Width="300"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="80"/>
      <!-- Фиксированная высота для полей ввода -->
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto" MinHeight="54"/>
      <!-- Для панели цепочек -->
      <RowDefinition/>
      <!-- Свободное пространство -->
      <RowDefinition Height="40"/>
      <!-- Фиксированная строка для кнопки -->
    </Grid.RowDefinitions>

    <!-- Заголовки -->
    <TextBlock Grid.Column="0" Grid.Row="0" Text="Сообщение агенту:" Style="{StaticResource PropertyNameStyle}" Width="200"/>
    <TextBlock Grid.Column="1" Grid.Row="0" Text="Распознанный текст:" Style="{StaticResource PropertyNameStyle}" Margin="10,0,0,5" Width="200"/>
    <TextBlock Grid.Column="2" Grid.Row="0" Text="Воздействие на агента:" Style="{StaticResource PropertyNameStyle}" Margin="10,0,0,5" Width="200"/>

    <!-- Окно сообщений агенту -->
    <TextBox Grid.Row="1" 
             Text="{Binding MessageText}"
             IsEnabled="True"
             Style="{StaticResource EditableFieldStyle}"
             MinWidth="350"
             Height="80"
             VerticalAlignment="Center" HorizontalAlignment="Center" Width="350"/>

    <!-- Отображение распознанного текста -->
    <Border Grid.Column="1" Grid.Row="1" 
            BorderBrush="#FFCCCCCC" 
            BorderThickness="1" 
            Background="#FFF8F8F8" 
            Padding="5" 
            Margin="10,0,0,0"
            Height="80"
            VerticalAlignment="Center">
      <TextBlock Text="{Binding RecognitionDisplayText}" 
                 Style="{StaticResource RecognitionTextStyle}"
                 ToolTip="xxxxx - нераспознанные слова"/>
    </Border>

    <!-- Панель тона и настроения -->
    <StackPanel Grid.Column="0" Grid.Row="2" 
                Orientation="Vertical" 
                HorizontalAlignment="Left"
                Margin="0,5,0,20"
                VerticalAlignment="Top" Grid.RowSpan="2" Width="347">

      <!-- Строка: Тон, Настроение, Авторитарная запись -->
      <StackPanel Orientation="Horizontal" Height="25">
        <!-- Выбор тона -->
        <StackPanel Orientation="Horizontal" Margin="0,0,10,0">
          <TextBlock Text="Тон:" 
                     VerticalAlignment="Center" 
                     Margin="0,0,2,0"
                     Width="30"/>
          <ComboBox ItemsSource="{Binding ToneList}"
                    SelectedValuePath="Key"
                    DisplayMemberPath="Value"
                    SelectedValue="{Binding SelectedToneId}"
                    Width="100"
                    Height="25"/>
        </StackPanel>

        <!-- Выбор настроения -->
        <StackPanel Orientation="Horizontal">
          <TextBlock Text="Настроение:" 
                     VerticalAlignment="Center" 
                     Margin="5,0,5,0"
                     Width="75"/>
          <ComboBox ItemsSource="{Binding MoodList}"
                    SelectedValuePath="Key"
                    DisplayMemberPath="Value"
                    SelectedValue="{Binding SelectedMoodId}"
                    Width="120"
                    Height="25"/>
        </StackPanel>

        <CheckBox Content="Авторитарная запись"
                  IsChecked="{Binding AuthoritativeMode}"
                  ToolTip="Новые фразы сразу записываются в дерево, минуя песочницу"
                  Margin="0,5,0,5"
                  FontWeight="Bold"
                  VerticalAlignment="Center"/>
      </StackPanel>

      <!-- Режим наблюдения -->
      <CheckBox Content="Режим наблюдения"
                IsChecked="{Binding ObservationMode}"
                Margin="0,5,0,0"
                ToolTip="Действия с пульта не оказывают влияния на гомеостаз агента, как будто он их наблюдает на другом"
                VerticalAlignment="Center"/>
    </StackPanel>

    <!-- Панель управления цепочкой -->
    <StackPanel Grid.Column="1" Grid.Row="2" Grid.RowSpan="2"
                Style="{StaticResource ChainPanelStyle}"
                Orientation="Vertical"
                Margin="5,0,0,0" Height="45" VerticalAlignment="Center" Width="290">

      <!-- Индикатор активности цепочки -->
      <Border BorderBrush="Gray" 
              BorderThickness="1" 
              Background="{Binding ChainActiveBackground}"
              Padding="5,2"
              Margin="5,0,0,2"
              Visibility="{Binding ChainControlVisibility}">
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
          <Ellipse Width="10" Height="10" Fill="{Binding ChainActiveIndicatorColor}" Margin="0,0,5,0"/>
          <TextBlock Text="{Binding ChainActiveStatusWithId}" 
                     FontWeight="Bold" 
                     Foreground="{Binding ChainActiveTextColor}"/>
        </StackPanel>
      </Border>

      <!-- Переключатель успеха/неуспеха -->
      <StackPanel Orientation="Horizontal" 
                  VerticalAlignment="Center"
                  Margin="0,5,0,0"
                  Visibility="{Binding ChainControlVisibility}">
        <TextBlock Text="Результат звена:" 
                   Margin="0,0,10,0" 
                   VerticalAlignment="Center"
                   ToolTip="Текущий результат выполнения действия в цепочке"/>
        <RadioButton Content="Успех" 
                     IsChecked="{Binding ChainStepSuccess, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     GroupName="ChainResult"
                     Margin="0,0,10,0"
                     ToolTip="Действие выполнено успешно"/>
        <RadioButton Content="Неудача" 
                     IsChecked="{Binding ChainStepFailure, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     GroupName="ChainResult"
                     ToolTip="Действие не выполнено или выполнено с ошибкой"/>
      </StackPanel>
    </StackPanel>

    <!-- Окно воздействий в два столбца -->
    <Grid Grid.Column="2" Grid.Row="1" Grid.RowSpan="4" Margin="10,0,0,0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Первый столбец воздействий -->
      <ItemsControl Grid.Column="0" ItemsSource="{Binding Column1Actions}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <CheckBox Content="{Binding Name}" 
                      IsChecked="{Binding IsSelected}"
                      IsEnabled="{Binding IsEnabled}"
                      Margin="0,2"
                      ToolTip="{Binding Description}"/>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <!-- Второй столбец воздействий -->
      <ItemsControl Grid.Column="1" ItemsSource="{Binding Column2Actions}" Margin="10,0,0,0">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <CheckBox Content="{Binding Name}" 
                      IsChecked="{Binding IsSelected}"
                      IsEnabled="{Binding IsEnabled}"
                      Margin="0,2"
                      ToolTip="{Binding Description}"/>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </Grid>

    <StackPanel Grid.Column="0" Grid.Row="5"
                Orientation="Horizontal" 
                Margin="0,5,0,5"
                Grid.ColumnSpan="3">
      <CheckBox Content="Авторитарная запись"
                IsChecked="{Binding AuthoritativeMode}"
                ToolTip="Новые фразы сразу записываются в дерево, минуя песочницу"
                Margin="0,5"
                VerticalAlignment="Center"/>

      <Button Content="Отправить" 
              Command="{Binding ApplyInfluenceCommand}"
              Style="{StaticResource ActionButtonStyle}"
              IsEnabled="{Binding IsEditingEnabled}" 
              Height="30" 
              Width="100"
              Margin="100,0,0,0"
              HorizontalAlignment="Left" 
              Cursor="Hand"/>
    </StackPanel>

  </Grid>
</UserControl>